input {
    http {
        port => "9600"
    }
    beats {
        port => "5044"
        ssl => true
        ssl_verify_mode => "force_peer"
        ssl_certificate_authorities => ["/etc/securebeat/ca/ca.crt"]
        ssl_certificate => "/etc/securebeat/server/tls.crt"
        ssl_key => "/etc/securebeat/server/tls.key"
    }
}
filter {
    if [message] == "" {
        drop { }
    }
    mutate {
        remove_field => ["headers","timestamp","host","log","@version","prospector","beat","input","source","offset","tags","stream"]
        gsub => ["message","enforcer output",""]
    }
    base64 {
        field => "message"
    }
    json {
        source => "message"
        target => "messagejson"
        skip_on_invalid_json => true
    }
    mutate {
        rename => { "[messagejson][desc]" => "desc" }
        rename => { "[messagejson][enforcer-version]" => "enforcer-version" }
        rename => { "[messagejson][sequence]" => "sequence" }
        rename => { "[messagejson][timestamp]" => "timestamp" }
    }
    date {
        match => [ "timestamp" ,"ISO8601" ]
    }
    mutate {
        remove_field => ["messagejson","message","timestamp"]
    }
}
output {
    elasticsearch {
        hosts => ["https://elasticsearch-service-exposed:443"]
        index => "mydata-%{+YYYY.MM.dd}"
        user => "nginx"
        password => "${ES_PASSWORD}"
        ssl => true
        ssl_certificate_verification => false
    }
}